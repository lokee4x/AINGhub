-- Services
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local CloseButton = Instance.new("TextButton")
local Sidebar = Instance.new("Frame")
local ESPTab = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")
local ESPContentFrame = Instance.new("Frame")
local ESPButton = Instance.new("TextButton")

ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- Main Frame
MainFrame.Parent = ScreenGui
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
MainFrame.Size = UDim2.new(0, 350, 0, 200)
MainFrame.Position = UDim2.new(0.3, 0, 0.3, 0)
MainFrame.Active = true  
MainFrame.Draggable = true 

-- Title Bar
Title.Parent = MainFrame
Title.Text = "AING Hub"
Title.TextSize = 16
Title.Size = UDim2.new(1, 0, 0.15, 0)
Title.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
Title.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Close Button
CloseButton.Parent = Title
CloseButton.Text = "X"
CloseButton.Size = UDim2.new(0.1, 0, 1, 0)
CloseButton.Position = UDim2.new(0.9, 0, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Sidebar
Sidebar.Parent = MainFrame
Sidebar.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
Sidebar.Size = UDim2.new(0.3, 0, 0.85, 0)
Sidebar.Position = UDim2.new(0, 0, 0.15, 0)

-- ESP Tab
ESPTab.Parent = Sidebar
ESPTab.Text = "ESP"
ESPTab.Size = UDim2.new(1, 0, 0.2, 0)
ESPTab.BackgroundColor3 = Color3.fromRGB(50, 50, 70)
ESPTab.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Content Frames
ESPContentFrame.Parent = MainFrame
ESPContentFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
ESPContentFrame.Size = UDim2.new(0.7, 0, 0.85, 0)
ESPContentFrame.Position = UDim2.new(0.3, 0, 0.15, 0)
ESPContentFrame.Visible = true

-- ESP Toggle Button
ESPButton.Parent = ESPContentFrame
ESPButton.Text = "ESP: OFF"
ESPButton.Size = UDim2.new(0.8, 0, 0.3, 0)
ESPButton.Position = UDim2.new(0.1, 0, 0.35, 0)
ESPButton.BackgroundColor3 = Color3.fromRGB(150, 0, 0)

-- ESP Functionality with Team Check and Animation
local espEnabled = false

local function isEnemy(player)
    local localPlayer = Players.LocalPlayer
    if localPlayer.Team ~= nil and player.Team ~= nil then
        return localPlayer.Team ~= player.Team  -- True if they are on different teams
    end
    return true  -- Default to enemy if no teams exist
end

local function createESP(player)
    if player == Players.LocalPlayer or not isEnemy(player) then return end  
    
    local character = player.Character
    if character and character:FindFirstChild("HumanoidRootPart") then
        local billboard = Instance.new("BillboardGui", character.HumanoidRootPart)
        billboard.Name = "ESP"
        billboard.Size = UDim2.new(0, 100, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true

        local nameLabel = Instance.new("TextLabel", billboard)
        nameLabel.Size = UDim2.new(1, 0, 1, 0)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = player.Name
        nameLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
        nameLabel.TextScaled = true
    end
end

local function removeESP(player)
    if player.Character then
        local esp = player.Character:FindFirstChild("ESP")
        if esp then
            esp:Destroy()
        end
    end
end

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPButton.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    local targetColor = espEnabled and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
    TweenService:Create(ESPButton, TweenInfo.new(0.3), {BackgroundColor3 = targetColor}):Play()

    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            createESP(player)
        end
        Players.PlayerAdded:Connect(createESP)
        Players.PlayerRemoving:Connect(removeESP)
    else
        for _, player in pairs(Players:GetPlayers()) do
            removeESP(player)
        end
    end
end)

-- Auto update ESP when teams change
Players.PlayerAdded:Connect(function(player)
    player:GetPropertyChangedSignal("Team"):Connect(function()
        if espEnabled then
            removeESP(player)
            createESP(player)
        end
    end)
end)

CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)
