-- GUI Creation
local ScreenGui = Instance.new("ScreenGui")
local MainFrame = Instance.new("Frame")
local Title = Instance.new("TextLabel")
local MinimizeButton = Instance.new("TextButton")
local CloseButton = Instance.new("TextButton")
local MinimizedIcon = Instance.new("TextButton")
local Sidebar = Instance.new("Frame")
local MainTab = Instance.new("TextButton")
local ESPTab = Instance.new("TextButton")
local ContentFrame = Instance.new("Frame")
local ESPContentFrame = Instance.new("Frame")
local ESPButton = Instance.new("TextButton")

-- Close Warning UI
local WarningFrame = Instance.new("Frame")
local WarningText = Instance.new("TextLabel")
local YesButton = Instance.new("TextButton")
local NoButton = Instance.new("TextButton")

-- Parent GUI to Player
ScreenGui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")

-- ESP Variables
local espEnabled = false
local espObjects = {}

-- Function to Remove All ESP
local function removeESP()
    for _, obj in ipairs(espObjects) do
        if obj then obj:Destroy() end
    end
    espObjects = {}
end

-- Function to Create ESP for Players
local function createESP(player)
    if player == game.Players.LocalPlayer or not espEnabled then return end

    local character = player.Character
    if not character then return end

    local teamCheck = game.Players.LocalPlayer.Team ~= player.Team

    if teamCheck then
        local head = character:FindFirstChild("Head")
        if head then
            local esp = Instance.new("BillboardGui")
            esp.Adornee = head
            esp.Size = UDim2.new(4, 0, 1, 0)
            esp.StudsOffset = Vector3.new(0, 2, 0)
            esp.AlwaysOnTop = true

            local text = Instance.new("TextLabel", esp)
            text.Size = UDim2.new(1, 0, 1, 0)
            text.Text = player.Name
            text.BackgroundTransparency = 1
            text.TextColor3 = Color3.fromRGB(255, 0, 0)
            text.TextStrokeTransparency = 0

            esp.Parent = head
            table.insert(espObjects, esp)
        end
    end
end

-- Function to Toggle ESP
ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    ESPButton.Text = espEnabled and "ESP: ON" or "ESP: OFF"
    ESPButton.BackgroundColor3 = espEnabled and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(150, 0, 0)

    if espEnabled then
        for _, player in pairs(game.Players:GetPlayers()) do
            createESP(player)
        end
        game.Players.PlayerAdded:Connect(createESP)
    else
        removeESP()
    end
end)

-- Close Warning UI Setup
WarningFrame.Parent = ScreenGui
WarningFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
WarningFrame.Size = UDim2.new(0, 200, 0, 100)
WarningFrame.Position = UDim2.new(0.5, -100, 0.5, -50)
WarningFrame.Visible = false

WarningText.Parent = WarningFrame
WarningText.Text = "Are you sure you want to close?"
WarningText.Size = UDim2.new(1, 0, 0.6, 0)
WarningText.TextColor3 = Color3.fromRGB(255, 255, 255)
WarningText.BackgroundTransparency = 1

YesButton.Parent = WarningFrame
YesButton.Text = "Yes"
YesButton.Size = UDim2.new(0.4, 0, 0.3, 0)
YesButton.Position = UDim2.new(0.1, 0, 0.65, 0)
YesButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
YesButton.TextColor3 = Color3.fromRGB(255, 255, 255)

NoButton.Parent = WarningFrame
NoButton.Text = "No"
NoButton.Size = UDim2.new(0.4, 0, 0.3, 0)
NoButton.Position = UDim2.new(0.5, 0, 0.65, 0)
NoButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
NoButton.TextColor3 = Color3.fromRGB(255, 255, 255)

-- Close Button Function (Opens Warning)
CloseButton.MouseButton1Click:Connect(function()
    WarningFrame.Visible = true
end)

-- Yes Button (Closes GUI)
YesButton.MouseButton1Click:Connect(function()
    espEnabled = false
    removeESP()
    ScreenGui:Destroy()
end)

-- No Button (Cancels Closing)
NoButton.MouseButton1Click:Connect(function()
    WarningFrame.Visible = false
end)
