local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local BlockedPlayers = {} -- Menyimpan pemain yang sudah diberi ESP

-- Fungsi untuk membuat ESP Box
local function createESP(player)
    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
        local box = Instance.new("BoxHandleAdornment")
        box.Size = Vector3.new(4, 6, 4)
        box.Adornee = player.Character.HumanoidRootPart
        box.Color3 = Color3.fromRGB(0, 255, 0) -- Warna hijau untuk pemain normal
        box.Transparency = 0.5
        box.ZIndex = 5
        box.AlwaysOnTop = true
        box.Parent = player.Character.HumanoidRootPart -- Perbaikan disini
        return box
    end
end

-- Tambahkan ESP hanya untuk pemain yang belum ada dalam daftar
local function addPlayerESP(player)
    if not BlockedPlayers[player.UserId] then
        local esp = createESP(player)
        if esp then
            BlockedPlayers[player.UserId] = esp
        end
    end
end

-- Hapus ESP jika pemain keluar dari game
local function removePlayerESP(player)
    if BlockedPlayers[player.UserId] then
        BlockedPlayers[player.UserId]:Destroy()
        BlockedPlayers[player.UserId] = nil
    end
end

-- Tambahkan ESP untuk semua pemain yang ada saat script dijalankan
for _, player in pairs(Players:GetPlayers()) do
    addPlayerESP(player)
end

-- Event listener untuk pemain yang baru join
Players.PlayerAdded:Connect(function(player)
    addPlayerESP(player)
end)

-- Event listener untuk pemain yang keluar
Players.PlayerRemoving:Connect(function(player)
    removePlayerESP(player)
end)

-- Update ESP setiap frame agar tetap mengikuti pemain
RunService.RenderStepped:Connect(function()
    for userId, esp in pairs(BlockedPlayers) do
        local player = Players:GetPlayerByUserId(userId)
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and esp.Parent then
            esp.Adornee = player.Character.HumanoidRootPart
        end
    end
end)

print("[âœ…] ESP Aktif dan Persistent!") -- Debug log
