-- GUI Library (UI Sederhana)
local Library = {} -- Buat library UI sendiri jika diperlukan
local Window = {} -- Placeholder untuk window UI

-- Buat GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 200, 0, 150)
Frame.Position = UDim2.new(0.5, -100, 0.5, -75)
Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Frame.Active = true
Frame.Draggable = true -- Bisa digeser
Frame.Parent = ScreenGui

-- Tombol Close
local CloseButton = Instance.new("TextButton")
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -35, 0, 5)
CloseButton.Text = "X"
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Parent = Frame

-- Tombol Toggle ESP
local ToggleButton = Instance.new("TextButton")
ToggleButton.Size = UDim2.new(0, 180, 0, 50)
ToggleButton.Position = UDim2.new(0, 10, 0, 50)
ToggleButton.Text = "Toggle ESP"
ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
ToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleButton.Parent = Frame

-- ESP Toggle Variable
local ESPEnabled = false
local HighlightCache = {} -- Cache untuk menyimpan highlight agar tidak dibuat berulang kali

-- Function untuk memberikan efek glow pada semua pemain
local function ApplyESP()
    for _, player in pairs(game:GetService("Players"):GetPlayers()) do
        if player ~= game.Players.LocalPlayer and player.Character then
            for _, part in pairs(player.Character:GetChildren()) do
                if part:IsA("BasePart") then
                    if not HighlightCache[part] then
                        local highlight = Instance.new("Highlight")
                        highlight.FillColor = Color3.fromRGB(255, 0, 0) -- Warna merah
                        highlight.OutlineColor = Color3.fromRGB(255, 255, 255) -- Outline putih
                        highlight.Parent = part
                        HighlightCache[part] = highlight
                    end
                end
            end
        end
    end
end

-- Function untuk menghapus efek glow dari semua pemain
local function RemoveESP()
    for part, highlight in pairs(HighlightCache) do
        if highlight then
            highlight:Destroy()
        end
    end
    HighlightCache = {} -- Bersihkan cache setelah menghapus ESP
end

-- Toggle ESP saat tombol ditekan
ToggleButton.MouseButton1Click:Connect(function()
    ESPEnabled = not ESPEnabled
    if ESPEnabled then
        ApplyESP()
        ToggleButton.Text = "ESP ON"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(85, 255, 85)
    else
        RemoveESP()
        ToggleButton.Text = "ESP OFF"
        ToggleButton.BackgroundColor3 = Color3.fromRGB(255, 85, 85)
    end
end)

-- Close GUI saat tombol close ditekan
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

-- Update ESP saat karakter pemain ditambahkan atau berubah
local function OnCharacterAdded(character)
    if ESPEnabled then
        ApplyESP()
    end
end

for _, player in pairs(game:GetService("Players"):GetPlayers()) do
    player.CharacterAdded:Connect(OnCharacterAdded)
end

game:GetService("Players").PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(OnCharacterAdded)
end)
